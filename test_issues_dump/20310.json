{
  "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
  "repository_url": "https://api.github.com/repos/eclipse-openj9/openj9",
  "labels_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310/labels{/name}",
  "comments_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310/comments",
  "events_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310/events",
  "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310",
  "id": 2570803145,
  "node_id": "I_kwDOBgtddc6ZO1fJ",
  "number": 20310,
  "title": "Periodic disclaim of JCL and misc memory",
  "user": {
    "login": "tajila",
    "id": 12551021,
    "node_id": "MDQ6VXNlcjEyNTUxMDIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tajila",
    "html_url": "https://github.com/tajila",
    "followers_url": "https://api.github.com/users/tajila/followers",
    "following_url": "https://api.github.com/users/tajila/following{/other_user}",
    "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
    "organizations_url": "https://api.github.com/users/tajila/orgs",
    "repos_url": "https://api.github.com/users/tajila/repos",
    "events_url": "https://api.github.com/users/tajila/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tajila/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "labels": [
    {
      "id": 697962110,
      "node_id": "MDU6TGFiZWw2OTc5NjIxMTA=",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/labels/comp:vm",
      "name": "comp:vm",
      "color": "1d76db",
      "default": false,
      "description": null
    },
    {
      "id": 698099135,
      "node_id": "MDU6TGFiZWw2OTgwOTkxMzU=",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/labels/perf",
      "name": "perf",
      "color": "5319e7",
      "default": false,
      "description": null
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "ThanHenderson",
    "id": 35206064,
    "node_id": "MDQ6VXNlcjM1MjA2MDY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ThanHenderson",
    "html_url": "https://github.com/ThanHenderson",
    "followers_url": "https://api.github.com/users/ThanHenderson/followers",
    "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
    "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
    "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
    "repos_url": "https://api.github.com/users/ThanHenderson/repos",
    "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
    "type": "User",
    "user_view_type": "public",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ThanHenderson",
      "id": 35206064,
      "node_id": "MDQ6VXNlcjM1MjA2MDY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ThanHenderson",
      "html_url": "https://github.com/ThanHenderson",
      "followers_url": "https://api.github.com/users/ThanHenderson/followers",
      "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
      "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
      "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
      "repos_url": "https://api.github.com/users/ThanHenderson/repos",
      "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
      "type": "User",
      "user_view_type": "public",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2024-10-07T15:35:46Z",
  "updated_at": "2024-10-09T17:10:24Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "type": null,
  "active_lock_reason": null,
  "sub_issues_summary": {
    "total": 0,
    "completed": 0,
    "percent_completed": 0
  },
  "body": "The goal of this item is to capture and understand what contributes to JVM memory footprint, then assess the impact of perodically disclaiming this memory from a footprint and throughput perspective. Much of this work has already been accomplished for JIT code cache, JIT data cache and VM class memory. \r\n\r\nThere is still a substantial amount of memory that is unaccounted for, this is predominantly driven by memory allocations done in JCL natives. The main challenge is that JCL natives are using APIs like malloc/free directly so there is no way for us to track the usage like we do with j9mem_allocate_memory which adds callsite info that can be tracked. Furthermore, because we cant track these allocations, it will be impossible for us to disclaim this memory.\r\n\r\n1) Use a standard tool like valgrind to get an understaning of what contributes to the memory footprint. We are really only concerned with RSS, and we would like to know what this looks like at first response for a Liberty restcrud/pringperf application (https://github.ibm.com/wasperf/restCrud, https://github.ibm.com/wasperf/pingperf). Ideally, this would be done with checkpoint/restore but if there are issues getting this to work with valgrind then a normal run will suffice.\r\n\r\n2) Attempt to install a custom malloc/free to track allocations by adding an allocator lib to the LD_PRELOAD path. \r\n\r\n3) Once we can track allocations then we can attempt to disclaim malloc'ed memory periodically. We will need a mechanism to register all malloc'ed callsites then add them to a list. Then we will need a function that runs through the list and attempts to disclaim (ie. `madvise(PAGE_OUT,...)`), similar to https://github.com/eclipse-openj9/openj9/pull/19609/files#diff-8b0a325c36e4697805c60ce54cd6e06ea8ce46d3cb26659b4b84e509ab2a6e68R463 The JIT already has a mechanism for perdiodic disclaim so we can piggy-back on this ( `HookedByTheJIT::memoryDisclaimLogic`  around where` disclaimDataCaches(crtElapsedTime);` is called).\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310/timeline",
  "performed_via_github_app": null,
  "state_reason": null,
  "timeline_data": [
    {
      "id": 14542934515,
      "node_id": "LE_lADOBgtddc6ZO1fJzwAAAANi05Hz",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/events/14542934515",
      "actor": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "event": "labeled",
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T15:35:46Z",
      "label": {
        "name": "comp:vm",
        "color": "1d76db"
      },
      "performed_via_github_app": null
    },
    {
      "id": 14542934525,
      "node_id": "LE_lADOBgtddc6ZO1fJzwAAAANi05H9",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/events/14542934525",
      "actor": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "event": "labeled",
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T15:35:46Z",
      "label": {
        "name": "perf",
        "color": "5319e7"
      },
      "performed_via_github_app": null
    },
    {
      "id": 14542936279,
      "node_id": "AE_lADOBgtddc6ZO1fJzwAAAANi05jX",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/events/14542936279",
      "actor": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "event": "assigned",
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-07T15:35:53Z",
      "assignee": {
        "login": "ThanHenderson",
        "id": 35206064,
        "node_id": "MDQ6VXNlcjM1MjA2MDY0",
        "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThanHenderson",
        "html_url": "https://github.com/ThanHenderson",
        "followers_url": "https://api.github.com/users/ThanHenderson/followers",
        "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
        "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
        "repos_url": "https://api.github.com/users/ThanHenderson/repos",
        "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "performed_via_github_app": null
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2397268778",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2397268778",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2397268778,
      "node_id": "IC_kwDOBgtddc6O42sq",
      "user": {
        "login": "github-actions[bot]",
        "id": 41898282,
        "node_id": "MDM6Qm90NDE4OTgyODI=",
        "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/github-actions%5Bbot%5D",
        "html_url": "https://github.com/apps/github-actions",
        "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
        "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
        "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
        "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
        "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
        "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
        "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
        "type": "Bot",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-07T15:36:11Z",
      "updated_at": "2024-10-07T15:36:11Z",
      "author_association": "NONE",
      "body": "Issue Number: 20310\nStatus: Open\nRecommended Components: comp:vm, comp:gc, comp:build\nRecommended Assignees: dmitripivkine, babsingh, tajila\n",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2397268778/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": {
        "id": 15368,
        "client_id": "Iv1.05c79e9ad1f6bdfa",
        "slug": "github-actions",
        "node_id": "MDM6QXBwMTUzNjg=",
        "owner": {
          "login": "github",
          "id": 9919,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjk5MTk=",
          "avatar_url": "https://avatars.githubusercontent.com/u/9919?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/github",
          "html_url": "https://github.com/github",
          "followers_url": "https://api.github.com/users/github/followers",
          "following_url": "https://api.github.com/users/github/following{/other_user}",
          "gists_url": "https://api.github.com/users/github/gists{/gist_id}",
          "starred_url": "https://api.github.com/users/github/starred{/owner}{/repo}",
          "subscriptions_url": "https://api.github.com/users/github/subscriptions",
          "organizations_url": "https://api.github.com/users/github/orgs",
          "repos_url": "https://api.github.com/users/github/repos",
          "events_url": "https://api.github.com/users/github/events{/privacy}",
          "received_events_url": "https://api.github.com/users/github/received_events",
          "type": "Organization",
          "user_view_type": "public",
          "site_admin": false
        },
        "name": "GitHub Actions",
        "description": "Automate your workflow from idea to production",
        "external_url": "https://help.github.com/en/actions",
        "html_url": "https://github.com/apps/github-actions",
        "created_at": "2018-07-30T09:30:17Z",
        "updated_at": "2025-03-07T16:35:00Z",
        "permissions": {
          "actions": "write",
          "administration": "read",
          "attestations": "write",
          "checks": "write",
          "contents": "write",
          "deployments": "write",
          "discussions": "write",
          "issues": "write",
          "merge_queues": "write",
          "metadata": "read",
          "models": "read",
          "packages": "write",
          "pages": "write",
          "pull_requests": "write",
          "repository_hooks": "write",
          "repository_projects": "write",
          "security_events": "write",
          "statuses": "write",
          "vulnerability_alerts": "read"
        },
        "events": [
          "branch_protection_rule",
          "check_run",
          "check_suite",
          "create",
          "delete",
          "deployment",
          "deployment_status",
          "discussion",
          "discussion_comment",
          "fork",
          "gollum",
          "issues",
          "issue_comment",
          "label",
          "merge_group",
          "milestone",
          "page_build",
          "project",
          "project_card",
          "project_column",
          "public",
          "pull_request",
          "pull_request_review",
          "pull_request_review_comment",
          "push",
          "registry_package",
          "release",
          "repository",
          "repository_dispatch",
          "status",
          "watch",
          "workflow_dispatch",
          "workflow_run"
        ]
      },
      "event": "commented",
      "actor": {
        "login": "github-actions[bot]",
        "id": 41898282,
        "node_id": "MDM6Qm90NDE4OTgyODI=",
        "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/github-actions%5Bbot%5D",
        "html_url": "https://github.com/apps/github-actions",
        "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
        "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
        "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
        "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
        "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
        "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
        "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
        "type": "Bot",
        "user_view_type": "public",
        "site_admin": false
      }
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2397274049",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2397274049",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2397274049,
      "node_id": "IC_kwDOBgtddc6O43_B",
      "user": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-07T15:38:29Z",
      "updated_at": "2024-10-07T15:38:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Use a standard tool like valgrind to get an understaning of what contributes to the memory footprint. \r\n\r\nI have already collected data with smaps, so if using valgrind is unsuccessful of too complex I can give you this data.",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2397274049/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null,
      "event": "commented",
      "actor": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      }
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2400876274",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2400876274",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2400876274,
      "node_id": "IC_kwDOBgtddc6PGnby",
      "user": {
        "login": "ThanHenderson",
        "id": 35206064,
        "node_id": "MDQ6VXNlcjM1MjA2MDY0",
        "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThanHenderson",
        "html_url": "https://github.com/ThanHenderson",
        "followers_url": "https://api.github.com/users/ThanHenderson/followers",
        "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
        "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
        "repos_url": "https://api.github.com/users/ThanHenderson/repos",
        "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-08T21:44:14Z",
      "updated_at": "2024-10-08T21:44:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Attempt to install a custom malloc/free to track allocations by adding an allocator lib to the LD_PRELOAD path.\r\n\r\nI'm not sure how effective this would be. Our memory allocator APIs (`j9mem_allocate_memory` and the like), use `malloc` internally, so any custom tracking with an `LD_PRELOAD`ed library would be a catch all for those allocations as well.\r\n\r\nI think the way to do this is to set up a wrapper (I guess similar to [this](https://github.com/eclipse-openj9/openj9/blob/8357d17869fedf6b29018582bd88fe7b0c63ad31/runtime/zip/zipalloc.c)) that forwards all `malloc` and `free` calls  (and other allocation functions if there are any) to the corresponding `j9mem` function, then forward a specifying [flag](https://github.com/eclipse-openj9/openj9/blob/595107b3403cd0a74428ca1f2abb95e85242491c/runtime/include/j9memcategories.h) (something like `J9MEM_CATEGORY_VM_JCL_NATIVES`) that we can match on in our `j9mem` (`omrmem`) functions to set up the list mechanism.\r\n\r\n> similar to https://github.com/eclipse-openj9/openj9/pull/19609/files#diff-8b0a325c36e4697805c60ce54cd6e06ea8ce46d3cb26659b4b84e509ab2a6e68R463\r\n\r\nAre we still wanting to push this forward too? i.e. disclaiming the `ClassLoader` segments on checkpoint? Are there any other memory segment lists that we could be traversing and `madvise`ing out?\r\n ",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2400876274/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null,
      "event": "commented",
      "actor": {
        "login": "ThanHenderson",
        "id": 35206064,
        "node_id": "MDQ6VXNlcjM1MjA2MDY0",
        "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThanHenderson",
        "html_url": "https://github.com/ThanHenderson",
        "followers_url": "https://api.github.com/users/ThanHenderson/followers",
        "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
        "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
        "repos_url": "https://api.github.com/users/ThanHenderson/repos",
        "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      }
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402542429",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2402542429",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2402542429,
      "node_id": "IC_kwDOBgtddc6PM-Nd",
      "user": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-09T14:42:17Z",
      "updated_at": "2024-10-09T14:42:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I think the way to do this is to set up a wrapper (I guess similar to [this](https://github.com/eclipse-openj9/openj9/blob/8357d17869fedf6b29018582bd88fe7b0c63ad31/runtime/zip/zipalloc.c)) that forwards all malloc and free calls (and other allocation functions if there are any) to the corresponding j9mem function, then forward a specifying [flag](https://github.com/eclipse-openj9/openj9/blob/595107b3403cd0a74428ca1f2abb95e85242491c/runtime/include/j9memcategories.h) (something like J9MEM_CATEGORY_VM_JCL_NATIVES) that we can match on in our j9mem (omrmem) functions to set up the list mechanism.\r\n\r\nWould this wrapper mechanism work for calls to malloc/free that are made outside J9 code? possibly even before the j9vm29.so is linked?\r\n\r\n\r\n> Are we still wanting to push this forward too? i.e. disclaiming the ClassLoader segments on checkpoint? \r\n\r\n@ymanton has been working on this. \r\n\r\n> Are there any other memory segment lists that we could be traversing and madviseing out?\r\n\r\nThe most obvious candidates have already been addressed",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402542429/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null,
      "event": "commented",
      "actor": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      }
    },
    {
      "id": 14574328594,
      "node_id": "MEE_lADOBgtddc6ZO1fJzwAAAANkspsS",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/events/14574328594",
      "actor": {
        "login": "ymanton",
        "id": 926840,
        "node_id": "MDQ6VXNlcjkyNjg0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/926840?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ymanton",
        "html_url": "https://github.com/ymanton",
        "followers_url": "https://api.github.com/users/ymanton/followers",
        "following_url": "https://api.github.com/users/ymanton/following{/other_user}",
        "gists_url": "https://api.github.com/users/ymanton/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ymanton/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ymanton/subscriptions",
        "organizations_url": "https://api.github.com/users/ymanton/orgs",
        "repos_url": "https://api.github.com/users/ymanton/repos",
        "events_url": "https://api.github.com/users/ymanton/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ymanton/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "event": "mentioned",
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-09T14:42:18Z",
      "performed_via_github_app": null
    },
    {
      "id": 14574328626,
      "node_id": "SE_lADOBgtddc6ZO1fJzwAAAANkspsy",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/events/14574328626",
      "actor": {
        "login": "ymanton",
        "id": 926840,
        "node_id": "MDQ6VXNlcjkyNjg0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/926840?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ymanton",
        "html_url": "https://github.com/ymanton",
        "followers_url": "https://api.github.com/users/ymanton/followers",
        "following_url": "https://api.github.com/users/ymanton/following{/other_user}",
        "gists_url": "https://api.github.com/users/ymanton/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ymanton/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ymanton/subscriptions",
        "organizations_url": "https://api.github.com/users/ymanton/orgs",
        "repos_url": "https://api.github.com/users/ymanton/repos",
        "events_url": "https://api.github.com/users/ymanton/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ymanton/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "event": "subscribed",
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-09T14:42:18Z",
      "performed_via_github_app": null
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402799831",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2402799831",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2402799831,
      "node_id": "IC_kwDOBgtddc6PN9DX",
      "user": {
        "login": "ymanton",
        "id": 926840,
        "node_id": "MDQ6VXNlcjkyNjg0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/926840?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ymanton",
        "html_url": "https://github.com/ymanton",
        "followers_url": "https://api.github.com/users/ymanton/followers",
        "following_url": "https://api.github.com/users/ymanton/following{/other_user}",
        "gists_url": "https://api.github.com/users/ymanton/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ymanton/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ymanton/subscriptions",
        "organizations_url": "https://api.github.com/users/ymanton/orgs",
        "repos_url": "https://api.github.com/users/ymanton/repos",
        "events_url": "https://api.github.com/users/ymanton/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ymanton/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-09T16:34:49Z",
      "updated_at": "2024-10-09T16:34:49Z",
      "author_association": "MEMBER",
      "body": "> @ymanton has been working on this.\r\n\r\nI'm currently doing performance testing to figure out how the rate of periodic disclaim affects throughput on various Liberty-based benchmarks. In addition to JCL I hacked up a quick prototype to disclaim SCC memory.",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402799831/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null,
      "event": "commented",
      "actor": {
        "login": "ymanton",
        "id": 926840,
        "node_id": "MDQ6VXNlcjkyNjg0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/926840?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ymanton",
        "html_url": "https://github.com/ymanton",
        "followers_url": "https://api.github.com/users/ymanton/followers",
        "following_url": "https://api.github.com/users/ymanton/following{/other_user}",
        "gists_url": "https://api.github.com/users/ymanton/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ymanton/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ymanton/subscriptions",
        "organizations_url": "https://api.github.com/users/ymanton/orgs",
        "repos_url": "https://api.github.com/users/ymanton/repos",
        "events_url": "https://api.github.com/users/ymanton/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ymanton/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      }
    },
    {
      "id": 14576114642,
      "node_id": "MEE_lADOBgtddc6ZO1fJzwAAAANkzdvS",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/events/14576114642",
      "actor": {
        "login": "ymanton",
        "id": 926840,
        "node_id": "MDQ6VXNlcjkyNjg0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/926840?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ymanton",
        "html_url": "https://github.com/ymanton",
        "followers_url": "https://api.github.com/users/ymanton/followers",
        "following_url": "https://api.github.com/users/ymanton/following{/other_user}",
        "gists_url": "https://api.github.com/users/ymanton/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ymanton/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ymanton/subscriptions",
        "organizations_url": "https://api.github.com/users/ymanton/orgs",
        "repos_url": "https://api.github.com/users/ymanton/repos",
        "events_url": "https://api.github.com/users/ymanton/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ymanton/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "event": "mentioned",
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-09T16:34:52Z",
      "performed_via_github_app": null
    },
    {
      "id": 14576114657,
      "node_id": "SE_lADOBgtddc6ZO1fJzwAAAANkzdvh",
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/events/14576114657",
      "actor": {
        "login": "ymanton",
        "id": 926840,
        "node_id": "MDQ6VXNlcjkyNjg0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/926840?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ymanton",
        "html_url": "https://github.com/ymanton",
        "followers_url": "https://api.github.com/users/ymanton/followers",
        "following_url": "https://api.github.com/users/ymanton/following{/other_user}",
        "gists_url": "https://api.github.com/users/ymanton/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ymanton/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ymanton/subscriptions",
        "organizations_url": "https://api.github.com/users/ymanton/orgs",
        "repos_url": "https://api.github.com/users/ymanton/repos",
        "events_url": "https://api.github.com/users/ymanton/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ymanton/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "event": "subscribed",
      "commit_id": null,
      "commit_url": null,
      "created_at": "2024-10-09T16:34:52Z",
      "performed_via_github_app": null
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402806525",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2402806525",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2402806525,
      "node_id": "IC_kwDOBgtddc6PN-r9",
      "user": {
        "login": "ThanHenderson",
        "id": 35206064,
        "node_id": "MDQ6VXNlcjM1MjA2MDY0",
        "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThanHenderson",
        "html_url": "https://github.com/ThanHenderson",
        "followers_url": "https://api.github.com/users/ThanHenderson/followers",
        "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
        "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
        "repos_url": "https://api.github.com/users/ThanHenderson/repos",
        "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-09T16:38:09Z",
      "updated_at": "2024-10-09T16:38:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Would this wrapper mechanism work for calls to malloc/free that are made outside J9 code? possibly even before the j9vm29.so is linked?\r\n\r\nIt would work for whatever we link it in with. If we are targeting the JCL native allocations, we would just need to link to the overrides when compiling the JCL native code. We'd obviously need to have the object file (and `.so` module containing the `j9mem`/`omrmem` functions) compiled before linking the JCL native code.\r\n\r\n> made outside J9 code?\r\n\r\nDo you mean outside the `extension repo + OpenJ9 + OMR` code? If so then no, it would not by default pick up all `malloc` requests. Are we wanting to target `malloc`s outside of the JCL native code (or OpenJ9) too?",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402806525/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null,
      "event": "commented",
      "actor": {
        "login": "ThanHenderson",
        "id": 35206064,
        "node_id": "MDQ6VXNlcjM1MjA2MDY0",
        "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThanHenderson",
        "html_url": "https://github.com/ThanHenderson",
        "followers_url": "https://api.github.com/users/ThanHenderson/followers",
        "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
        "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
        "repos_url": "https://api.github.com/users/ThanHenderson/repos",
        "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      }
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402866734",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2402866734",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2402866734,
      "node_id": "IC_kwDOBgtddc6PONYu",
      "user": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-09T17:10:22Z",
      "updated_at": "2024-10-09T17:10:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "> It would work for whatever we link it in with. If we are targeting the JCL native allocations, we would just need to link to the overrides when compiling the JCL native code. We'd obviously need to have the object file (and .so module containing the j9mem/omrmem functions) compiled before linking the JCL native code.\r\n\r\nSounds good. Im fairly certain we build openj9 before building the JCL natives.\r\n\r\n\r\n> Do you mean outside the extension repo + OpenJ9 + OMR code? If so then no, it would not by default pick up all malloc requests. Are we wanting to target mallocs outside of the JCL native code (or OpenJ9) too?\r\n\r\nI just mean outside Openj9 + OMR. I'm mostly concerned about tracking/disclaiming allocations in the extensions repo since this is the biggest unknown at the moment. It would be nice to eventually track/disclaim allocations done with libc if it is significant (which is why I suggested the preload approach) but we can revisit after taking a look at allocations in the extensions repo.",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402866734/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null,
      "event": "commented",
      "actor": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      }
    }
  ],
  "comments_data": [
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2397268778",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2397268778",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2397268778,
      "node_id": "IC_kwDOBgtddc6O42sq",
      "user": {
        "login": "github-actions[bot]",
        "id": 41898282,
        "node_id": "MDM6Qm90NDE4OTgyODI=",
        "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/github-actions%5Bbot%5D",
        "html_url": "https://github.com/apps/github-actions",
        "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
        "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
        "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
        "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
        "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
        "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
        "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
        "type": "Bot",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-07T15:36:11Z",
      "updated_at": "2024-10-07T15:36:11Z",
      "author_association": "NONE",
      "body": "Issue Number: 20310\nStatus: Open\nRecommended Components: comp:vm, comp:gc, comp:build\nRecommended Assignees: dmitripivkine, babsingh, tajila\n",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2397268778/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": {
        "id": 15368,
        "client_id": "Iv1.05c79e9ad1f6bdfa",
        "slug": "github-actions",
        "node_id": "MDM6QXBwMTUzNjg=",
        "owner": {
          "login": "github",
          "id": 9919,
          "node_id": "MDEyOk9yZ2FuaXphdGlvbjk5MTk=",
          "avatar_url": "https://avatars.githubusercontent.com/u/9919?v=4",
          "gravatar_id": "",
          "url": "https://api.github.com/users/github",
          "html_url": "https://github.com/github",
          "followers_url": "https://api.github.com/users/github/followers",
          "following_url": "https://api.github.com/users/github/following{/other_user}",
          "gists_url": "https://api.github.com/users/github/gists{/gist_id}",
          "starred_url": "https://api.github.com/users/github/starred{/owner}{/repo}",
          "subscriptions_url": "https://api.github.com/users/github/subscriptions",
          "organizations_url": "https://api.github.com/users/github/orgs",
          "repos_url": "https://api.github.com/users/github/repos",
          "events_url": "https://api.github.com/users/github/events{/privacy}",
          "received_events_url": "https://api.github.com/users/github/received_events",
          "type": "Organization",
          "user_view_type": "public",
          "site_admin": false
        },
        "name": "GitHub Actions",
        "description": "Automate your workflow from idea to production",
        "external_url": "https://help.github.com/en/actions",
        "html_url": "https://github.com/apps/github-actions",
        "created_at": "2018-07-30T09:30:17Z",
        "updated_at": "2025-03-07T16:35:00Z",
        "permissions": {
          "actions": "write",
          "administration": "read",
          "attestations": "write",
          "checks": "write",
          "contents": "write",
          "deployments": "write",
          "discussions": "write",
          "issues": "write",
          "merge_queues": "write",
          "metadata": "read",
          "models": "read",
          "packages": "write",
          "pages": "write",
          "pull_requests": "write",
          "repository_hooks": "write",
          "repository_projects": "write",
          "security_events": "write",
          "statuses": "write",
          "vulnerability_alerts": "read"
        },
        "events": [
          "branch_protection_rule",
          "check_run",
          "check_suite",
          "create",
          "delete",
          "deployment",
          "deployment_status",
          "discussion",
          "discussion_comment",
          "fork",
          "gollum",
          "issues",
          "issue_comment",
          "label",
          "merge_group",
          "milestone",
          "page_build",
          "project",
          "project_card",
          "project_column",
          "public",
          "pull_request",
          "pull_request_review",
          "pull_request_review_comment",
          "push",
          "registry_package",
          "release",
          "repository",
          "repository_dispatch",
          "status",
          "watch",
          "workflow_dispatch",
          "workflow_run"
        ]
      }
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2397274049",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2397274049",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2397274049,
      "node_id": "IC_kwDOBgtddc6O43_B",
      "user": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-07T15:38:29Z",
      "updated_at": "2024-10-07T15:38:29Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Use a standard tool like valgrind to get an understaning of what contributes to the memory footprint. \r\n\r\nI have already collected data with smaps, so if using valgrind is unsuccessful of too complex I can give you this data.",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2397274049/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2400876274",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2400876274",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2400876274,
      "node_id": "IC_kwDOBgtddc6PGnby",
      "user": {
        "login": "ThanHenderson",
        "id": 35206064,
        "node_id": "MDQ6VXNlcjM1MjA2MDY0",
        "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThanHenderson",
        "html_url": "https://github.com/ThanHenderson",
        "followers_url": "https://api.github.com/users/ThanHenderson/followers",
        "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
        "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
        "repos_url": "https://api.github.com/users/ThanHenderson/repos",
        "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-08T21:44:14Z",
      "updated_at": "2024-10-08T21:44:14Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Attempt to install a custom malloc/free to track allocations by adding an allocator lib to the LD_PRELOAD path.\r\n\r\nI'm not sure how effective this would be. Our memory allocator APIs (`j9mem_allocate_memory` and the like), use `malloc` internally, so any custom tracking with an `LD_PRELOAD`ed library would be a catch all for those allocations as well.\r\n\r\nI think the way to do this is to set up a wrapper (I guess similar to [this](https://github.com/eclipse-openj9/openj9/blob/8357d17869fedf6b29018582bd88fe7b0c63ad31/runtime/zip/zipalloc.c)) that forwards all `malloc` and `free` calls  (and other allocation functions if there are any) to the corresponding `j9mem` function, then forward a specifying [flag](https://github.com/eclipse-openj9/openj9/blob/595107b3403cd0a74428ca1f2abb95e85242491c/runtime/include/j9memcategories.h) (something like `J9MEM_CATEGORY_VM_JCL_NATIVES`) that we can match on in our `j9mem` (`omrmem`) functions to set up the list mechanism.\r\n\r\n> similar to https://github.com/eclipse-openj9/openj9/pull/19609/files#diff-8b0a325c36e4697805c60ce54cd6e06ea8ce46d3cb26659b4b84e509ab2a6e68R463\r\n\r\nAre we still wanting to push this forward too? i.e. disclaiming the `ClassLoader` segments on checkpoint? Are there any other memory segment lists that we could be traversing and `madvise`ing out?\r\n ",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2400876274/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402542429",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2402542429",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2402542429,
      "node_id": "IC_kwDOBgtddc6PM-Nd",
      "user": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-09T14:42:17Z",
      "updated_at": "2024-10-09T14:42:17Z",
      "author_association": "CONTRIBUTOR",
      "body": "> I think the way to do this is to set up a wrapper (I guess similar to [this](https://github.com/eclipse-openj9/openj9/blob/8357d17869fedf6b29018582bd88fe7b0c63ad31/runtime/zip/zipalloc.c)) that forwards all malloc and free calls (and other allocation functions if there are any) to the corresponding j9mem function, then forward a specifying [flag](https://github.com/eclipse-openj9/openj9/blob/595107b3403cd0a74428ca1f2abb95e85242491c/runtime/include/j9memcategories.h) (something like J9MEM_CATEGORY_VM_JCL_NATIVES) that we can match on in our j9mem (omrmem) functions to set up the list mechanism.\r\n\r\nWould this wrapper mechanism work for calls to malloc/free that are made outside J9 code? possibly even before the j9vm29.so is linked?\r\n\r\n\r\n> Are we still wanting to push this forward too? i.e. disclaiming the ClassLoader segments on checkpoint? \r\n\r\n@ymanton has been working on this. \r\n\r\n> Are there any other memory segment lists that we could be traversing and madviseing out?\r\n\r\nThe most obvious candidates have already been addressed",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402542429/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402799831",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2402799831",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2402799831,
      "node_id": "IC_kwDOBgtddc6PN9DX",
      "user": {
        "login": "ymanton",
        "id": 926840,
        "node_id": "MDQ6VXNlcjkyNjg0MA==",
        "avatar_url": "https://avatars.githubusercontent.com/u/926840?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ymanton",
        "html_url": "https://github.com/ymanton",
        "followers_url": "https://api.github.com/users/ymanton/followers",
        "following_url": "https://api.github.com/users/ymanton/following{/other_user}",
        "gists_url": "https://api.github.com/users/ymanton/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ymanton/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ymanton/subscriptions",
        "organizations_url": "https://api.github.com/users/ymanton/orgs",
        "repos_url": "https://api.github.com/users/ymanton/repos",
        "events_url": "https://api.github.com/users/ymanton/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ymanton/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-09T16:34:49Z",
      "updated_at": "2024-10-09T16:34:49Z",
      "author_association": "MEMBER",
      "body": "> @ymanton has been working on this.\r\n\r\nI'm currently doing performance testing to figure out how the rate of periodic disclaim affects throughput on various Liberty-based benchmarks. In addition to JCL I hacked up a quick prototype to disclaim SCC memory.",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402799831/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402806525",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2402806525",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2402806525,
      "node_id": "IC_kwDOBgtddc6PN-r9",
      "user": {
        "login": "ThanHenderson",
        "id": 35206064,
        "node_id": "MDQ6VXNlcjM1MjA2MDY0",
        "avatar_url": "https://avatars.githubusercontent.com/u/35206064?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/ThanHenderson",
        "html_url": "https://github.com/ThanHenderson",
        "followers_url": "https://api.github.com/users/ThanHenderson/followers",
        "following_url": "https://api.github.com/users/ThanHenderson/following{/other_user}",
        "gists_url": "https://api.github.com/users/ThanHenderson/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/ThanHenderson/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/ThanHenderson/subscriptions",
        "organizations_url": "https://api.github.com/users/ThanHenderson/orgs",
        "repos_url": "https://api.github.com/users/ThanHenderson/repos",
        "events_url": "https://api.github.com/users/ThanHenderson/events{/privacy}",
        "received_events_url": "https://api.github.com/users/ThanHenderson/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-09T16:38:09Z",
      "updated_at": "2024-10-09T16:38:09Z",
      "author_association": "CONTRIBUTOR",
      "body": "> Would this wrapper mechanism work for calls to malloc/free that are made outside J9 code? possibly even before the j9vm29.so is linked?\r\n\r\nIt would work for whatever we link it in with. If we are targeting the JCL native allocations, we would just need to link to the overrides when compiling the JCL native code. We'd obviously need to have the object file (and `.so` module containing the `j9mem`/`omrmem` functions) compiled before linking the JCL native code.\r\n\r\n> made outside J9 code?\r\n\r\nDo you mean outside the `extension repo + OpenJ9 + OMR` code? If so then no, it would not by default pick up all `malloc` requests. Are we wanting to target `malloc`s outside of the JCL native code (or OpenJ9) too?",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402806525/reactions",
        "total_count": 0,
        "+1": 0,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null
    },
    {
      "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402866734",
      "html_url": "https://github.com/eclipse-openj9/openj9/issues/20310#issuecomment-2402866734",
      "issue_url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/20310",
      "id": 2402866734,
      "node_id": "IC_kwDOBgtddc6PONYu",
      "user": {
        "login": "tajila",
        "id": 12551021,
        "node_id": "MDQ6VXNlcjEyNTUxMDIx",
        "avatar_url": "https://avatars.githubusercontent.com/u/12551021?v=4",
        "gravatar_id": "",
        "url": "https://api.github.com/users/tajila",
        "html_url": "https://github.com/tajila",
        "followers_url": "https://api.github.com/users/tajila/followers",
        "following_url": "https://api.github.com/users/tajila/following{/other_user}",
        "gists_url": "https://api.github.com/users/tajila/gists{/gist_id}",
        "starred_url": "https://api.github.com/users/tajila/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/tajila/subscriptions",
        "organizations_url": "https://api.github.com/users/tajila/orgs",
        "repos_url": "https://api.github.com/users/tajila/repos",
        "events_url": "https://api.github.com/users/tajila/events{/privacy}",
        "received_events_url": "https://api.github.com/users/tajila/received_events",
        "type": "User",
        "user_view_type": "public",
        "site_admin": false
      },
      "created_at": "2024-10-09T17:10:22Z",
      "updated_at": "2024-10-09T17:10:22Z",
      "author_association": "CONTRIBUTOR",
      "body": "> It would work for whatever we link it in with. If we are targeting the JCL native allocations, we would just need to link to the overrides when compiling the JCL native code. We'd obviously need to have the object file (and .so module containing the j9mem/omrmem functions) compiled before linking the JCL native code.\r\n\r\nSounds good. Im fairly certain we build openj9 before building the JCL natives.\r\n\r\n\r\n> Do you mean outside the extension repo + OpenJ9 + OMR code? If so then no, it would not by default pick up all malloc requests. Are we wanting to target mallocs outside of the JCL native code (or OpenJ9) too?\r\n\r\nI just mean outside Openj9 + OMR. I'm mostly concerned about tracking/disclaiming allocations in the extensions repo since this is the biggest unknown at the moment. It would be nice to eventually track/disclaim allocations done with libc if it is significant (which is why I suggested the preload approach) but we can revisit after taking a look at allocations in the extensions repo.",
      "reactions": {
        "url": "https://api.github.com/repos/eclipse-openj9/openj9/issues/comments/2402866734/reactions",
        "total_count": 1,
        "+1": 1,
        "-1": 0,
        "laugh": 0,
        "hooray": 0,
        "confused": 0,
        "heart": 0,
        "rocket": 0,
        "eyes": 0
      },
      "performed_via_github_app": null
    }
  ]
}